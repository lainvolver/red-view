<!DOCTYPE html><html lang="ja"> <head><meta charset="utf-8"><title>アニメコメントランキング</title><link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css"><script type="module">const h=document.getElementById("seasonSelect"),_=document.getElementById("modeSelect"),k=document.getElementById("rankingBody"),E=document.getElementById("tableContainer"),y=document.getElementById("chartContainer"),$=document.getElementById("rankingChart");let f=null;const B=await fetch("data/reddit/seasons.json"),C=await B.json();C.forEach(m=>{const d=document.createElement("option");d.value=m.key+".json",d.textContent=m.label,h.appendChild(d)});h.value=C[0].key+".json";async function b(){const m=h.value,d=_.value,v=await(await fetch(`data/reddit/${m}`)).json();if(d==="history"){E.style.display="none",y.style.display="block";const o=Object.values(v.anime);let s=0;for(;;){let e=0;for(const t of o){const l=t.latest_episode-s;t.episodes&&t.episodes[l]&&t.episodes[l].length>0&&e++}if(e<=Math.floor(o.length/2))break;s++}s=Math.max(0,s-1);const r={};for(const e of o)r[e.name_jp]=[];for(let e=s;e>=0;e--){const t=[];for(const n of o){const p=n.latest_episode-e,j=n.episodes?.[p]?.[0]?.num_comments??0;t.push({name:n.name_jp,count:j,valid:j>0})}t.sort((n,p)=>p.count-n.count);let l=1;for(let n=0;n<t.length;n++){n>0&&t[n].count<t[n-1].count&&(l=n+1);const p=t[n].name;t[n].valid?r[p].push(l):r[p].push(null)}}const u=[];for(let e=s;e>=0;e--)e===0?u.push("最新話"):u.push(`最新話-${e}`);const c=[];let a=0;for(const e of o){const t=r[e.name_jp];if(t.every(p=>p===null))continue;const n=`hsl(${Math.floor(a*360/o.length)}, 70%, 50%)`;c.push({label:e.name_jp,data:t,borderColor:n,backgroundColor:n,fill:!1,tension:.1,spanGaps:!0}),a++}c.sort((e,t)=>{const l=e.data[e.data.length-1],n=t.data[t.data.length-1];return l===null&&n===null?0:l===null?1:n===null?-1:l-n});const i=c.length*25+100;y.style.height=`max(60vh, ${i}px)`,f&&f.destroy(),f=new Chart($,{type:"line",data:{labels:u,datasets:c},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{reverse:!0,beginAtZero:!1,title:{display:!0,text:"順位"},ticks:{stepSize:1}}},plugins:{legend:{position:"right"}}}});return}E.style.display="block",y.style.display="none",f&&(f.destroy(),f=null);const g=[];for(const o of Object.values(v.anime)){let s=0,r="",u="";const c=o.latest_episode;if(d==="latest"){const a=o.episodes?.[c]?.[0];if(!a)continue;s=a.num_comments??0,r=`第${c}話`,u=a.url}if(d==="previous"){const a=c-1,i=o.episodes?.[a]?.[0];if(!i)continue;s=i.num_comments??0,r=`第${a}話`,u=i.url}if(d==="total"){let a=0,i="";for(const[e,t]of Object.entries(o.episodes??{}))for(const l of t)s+=l.num_comments??0,a++,Number(e)===c&&(i=l.url);if(a===0)continue;r=`全${a}話分`,u=i}if(d==="average"){let a=0,i="";for(const[e,t]of Object.entries(o.episodes??{}))for(const l of t)s+=l.num_comments??0,a++,Number(e)===c&&(i=l.url);if(a===0)continue;r=`全${a}話分`,u=i,s=Math.round(s/a)}g.push({title:o.name_jp,episodeLabel:r,count:s,url:u})}g.sort((o,s)=>s.count-o.count),k.innerHTML="",g.forEach((o,s)=>{k.insertAdjacentHTML("beforeend",`<tr>
                  <td>${s+1}</td>
                  <td>${o.title}</td>
                  <td>${o.episodeLabel}</td>
                  <td>${o.count}</td>
                  <td>
                    <a href="${o.url}" target="_blank" rel="noopener">URL</a>
                  </td>
                </tr>`)})}h.addEventListener("change",b);_.addEventListener("change",b);b();</script><style>body{background-color:#bebebec7}h1{margin-bottom:1rem}table{font-size:.95rem;border-collapse:collapse}td,th{padding:.1rem 1.2rem}table tbody tr:nth-child(2n) td{background-color:#00000005}a{text-decoration:none;font-weight:500}a:hover{text-decoration:underline}
</style></head> <body> <main class="container"> <article> <h1>アニメコメントランキング</h1> <!-- コントロール --> <div> <label>
シーズン：
<select id="seasonSelect"></select> </label> <label>
ランキング種別：
<select id="modeSelect"> <option value="latest">最新話コメント数</option> <option value="previous">前話コメント数</option> <option value="total">トータルコメント数</option> <option value="average">平均コメント数</option> <option value="history">ランキング推移</option> </select> </label> </div> <div id="tableContainer"> <table border="1" cellpadding="6"> <thead> <tr> <th>順位</th> <th>作品名</th> <th>話数</th> <th>コメント数</th> <th>URL</th> </tr> </thead> <tbody id="rankingBody"></tbody> </table> </div> <div id="chartContainer" style="display: none; position: relative; height: 60vh; width: 100%;"> <canvas id="rankingChart"></canvas> </div> <script type="module" src="/red-view/_astro/index.astro_astro_type_script_index_1_lang.Ds9P6cqp.js"></script> </article> </main> </body> </html>